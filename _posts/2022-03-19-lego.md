---
layout: post
title: "Webscraping Lego data"
subtitle: "And creating an interactive 3D-Plot with the plotly R package"
background: '/img/posts/Rent/webscraping_bg.jpg'
---


# Scraping data from the lego.de website
## Afterwards fitting a linear regression model and visualizing results with the plotly R package.

I scraped data from the lego.de website. This includes the listprice, piececount, recommended age, category and article number. 

Afterwards I did a little exploratory data analysis and fitted a linear regression model.

The results where visualized in an interactive 3D Plot using the Plotly package.

![Lego page](/img/posts/Lego/Lego website.jpg)

```r
# install necessary packages
library(rvest)
library(RSelenium)
library(tidyverse)
library(netstat)
library(plotly)

rD <- rsDriver(browser=c("firefox"), free_port())
remDr <- rD$client

remDr$navigate("https://www.lego.com/de-de/themes/architecture")

webElem <- remDr$findElement("css", "body")
webElem$sendKeysToElement(list(key = "end"))



# Architecture ------------------------------------------------------------

# just using rvest
links.architecture = "https://www.lego.com/de-de/themes/architecture" %>% read_html() %>% 
  html_elements("a") %>% 
  html_attr("href") %>% 
  str_subset("/product/") %>% 
  unique()

links.architecture = paste0("https://www.lego.com", links.architecture)

sets.architecture = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.architecture)){
  
  html = read_html(links.architecture[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique

  sets.architecture = add_row(sets.architecture, price, setname, category, pieces, age, articlenum)
}

sets.architecture = sets.architecture[-5,]
sets.architecture


# Batman ------------------------------------------------------------------

links.batman = "https://www.lego.com/de-de/themes/lego-batman-sets" %>% read_html() %>% 
  html_elements("a") %>% 
  html_attr("href") %>% 
  str_subset("/product/") %>% 
  unique()

links.batman = paste0("https://www.lego.com", links.batman)

sets.batman = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.batman)){
  
  html = read_html(links.batman[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.batman = add_row(sets.batman, price, setname, category, pieces, age, articlenum)
  
}

sets.batman


# BOOST -------------------------------------------------------------------

links.BOOST = "https://www.lego.com/de-de/themes/boost" %>% read_html() %>% 
  html_elements("a") %>% 
  html_attr("href") %>% 
  str_subset("/product/") %>% 
  unique()

links.BOOST = paste0("https://www.lego.com", links.BOOST)

sets.BOOST = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.BOOST)){
  
  html = read_html(links.BOOST[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.BOOST = add_row(sets.BOOST, price, setname, category, pieces, age, articlenum)
  
}

sets.BOOST[1,1] = 169.99
sets.BOOST


# Brickheadz --------------------------------------------------------------

nextlinks.brickheadz = c("https://www.lego.com/de-de/themes/brickheadz","https://www.lego.com/de-de/themes/brickheadz?page=2")

links.brickheadz = c()
for (i in 1:2){
  remDr$navigate(nextlinks.brickheadz[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.brickheadz[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.brickheadz <- c(links.brickheadz, links)
}

links.brickheadz = paste0("https://www.lego.com", links.brickheadz)

sets.brickheadz = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.brickheadz)){
  
  html = read_html(links.brickheadz[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.brickheadz = add_row(sets.brickheadz, price, setname, category, pieces, age, articlenum)
}

sets.brickheadz


# Brick sketches ----------------------------------------------------------

links.bricksketches = "https://www.lego.com/de-de/themes/brick-sketches" %>% read_html() %>% 
  html_elements("a") %>% 
  html_attr("href") %>% 
  str_subset("/product/") %>% 
  unique()

links.bricksketches = paste0("https://www.lego.com", links.bricksketches)

sets.bricksketches = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.bricksketches)){
  
  html = read_html(links.bricksketches[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.bricksketches = add_row(sets.bricksketches, price, setname, category, pieces, age, articlenum)
  
}

sets.bricksketches



# City --------------------------------------------------------------------

nextlinks.city = c("https://www.lego.com/de-de/themes/city",paste0("https://www.lego.com/de-de/themes/city?page=",2:4))

links.city = c()
for (i in 1:length(nextlinks.city)){
  remDr$navigate(nextlinks.city[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.city[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.city <- c(links.city, links)
}

links.city = paste0("https://www.lego.com", links.city)

sets.city = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.city)){
  
  html = read_html(links.city[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.city = add_row(sets.city, price, setname, category, pieces, age, articlenum)
}

sets.city


# Classic -----------------------------------------------------------------

nextlinks.classic = c("https://www.lego.com/de-de/themes/classic", "https://www.lego.com/de-de/themes/classic?page=2")

links.classic = c()
for (i in 1:length(nextlinks.classic)){
  remDr$navigate(nextlinks.classic[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.classic[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.classic <- c(links.classic, links)
}

links.classic = paste0("https://www.lego.com", links.classic)

sets.classic = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.classic)){
  
  html = read_html(links.classic[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.classic = add_row(sets.classic, price, setname, category, pieces, age, articlenum)
}

sets.classic



# Creator 3 in 1 ----------------------------------------------------------

nextlinks.creator = c("https://www.lego.com/de-de/themes/creator-3-in-1", "https://www.lego.com/de-de/themes/creator-3-in-1?page=2")

links.creator = c()
for (i in 1:length(nextlinks.creator)){
  remDr$navigate(nextlinks.creator[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.creator[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.creator <- c(links.creator, links)
}

links.creator = paste0("https://www.lego.com", links.creator)

sets.creator = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.creator)){
  
  html = read_html(links.creator[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.creator = add_row(sets.creator, price, setname, category, pieces, age, articlenum)
}

sets.creator


# Creator expert ----------------------------------------------------------

nextlinks.creatorexp = c("https://www.lego.com/de-de/themes/creator-expert", "https://www.lego.com/de-de/themes/creator-expert?page=2")

links.creatorexp = c()
for (i in 1:length(nextlinks.creatorexp)){
  remDr$navigate(nextlinks.creatorexp[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.creatorexp[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.creatorexp <- c(links.creatorexp, links)
}

links.creatorexp = paste0("https://www.lego.com", links.creatorexp)

sets.creatorexp = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.creatorexp)){
  
  html = read_html(links.creatorexp[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.creatorexp = add_row(sets.creatorexp, price, setname, category, pieces, age, articlenum)
}

sets.creatorexp


# DC ----------------------------------------------------------------------

nextlinks.dc = "https://www.lego.com/de-de/themes/dc"

links.dc = c()
for (i in 1:length(nextlinks.dc)){
  remDr$navigate(nextlinks.dc[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.dc[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.dc <- c(links.dc, links)
}

links.dc = paste0("https://www.lego.com", links.dc)

sets.dc = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.dc)){
  
  html = read_html(links.dc[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.dc = add_row(sets.dc, price, setname, category, pieces, age, articlenum)
}

sets.dc


# Disney ------------------------------------------------------------------

nextlinks.disney = c("https://www.lego.com/de-de/themes/disney", paste0("https://www.lego.com/de-de/themes/disney?page=", 2:4))

links.disney = c()
for (i in 1:length(nextlinks.disney)){
  remDr$navigate(nextlinks.disney[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.disney[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.disney <- c(links.disney, links)
}

links.disney = paste0("https://www.lego.com", links.disney)

sets.disney = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.disney)){
  
  html = read_html(links.disney[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.disney = add_row(sets.disney, price, setname, category, pieces, age, articlenum)
}

sets.disney


# Disney Mickey and friends -----------------------------------------------

nextlinks.disneymicky = "https://www.lego.com/de-de/themes/mickey-mouse"

links.disneymicky = c()
for (i in 1:length(nextlinks.disneymicky)){
  remDr$navigate(nextlinks.disneymicky[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.disneymicky[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.disneymicky <- c(links.disneymicky, links)
}

links.disneymicky = paste0("https://www.lego.com", links.disneymicky)

sets.disneymicky = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.disneymicky)){
  
  html = read_html(links.disneymicky[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.disneymicky = add_row(sets.disneymicky, price, setname, category, pieces, age, articlenum)
}

sets.disneymicky


# DOTS --------------------------------------------------------------------

nextlinks.dots = c("https://www.lego.com/de-de/themes/dots", "https://www.lego.com/de-de/themes/dots?page=2")

links.dots = c()
for (i in 1:length(nextlinks.dots)){
  remDr$navigate(nextlinks.dots[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.dots[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.dots <- c(links.dots, links)
}

links.dots = paste0("https://www.lego.com", links.dots)

sets.dots = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.dots)){
  
  html = read_html(links.dots[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.dots = add_row(sets.dots, price, setname, category, pieces, age, articlenum)
}

sets.dots


# Frozen --------------------------------------------------------------

nextlinks.frozen = "https://www.lego.com/de-de/themes/disney-frozen-2"

links.frozen = c()
for (i in 1:length(nextlinks.frozen)){
  remDr$navigate(nextlinks.frozen[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.frozen[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.frozen <- c(links.frozen, links)
}

links.frozen = paste0("https://www.lego.com", links.frozen)

sets.frozen = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.frozen)){
  
  html = read_html(links.frozen[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.frozen = add_row(sets.frozen, price, setname, category, pieces, age, articlenum)
}

sets.frozen


# Harry Potter ------------------------------------------------------------

nextlinks.harrypotter = c("https://www.lego.com/de-de/themes/harry-potter", "https://www.lego.com/de-de/themes/harry-potter?page=2")

links.harrypotter = c()
for (i in 1:length(nextlinks.harrypotter)){
  remDr$navigate(nextlinks.harrypotter[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.harrypotter[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.harrypotter <- c(links.harrypotter, links)
}

links.harrypotter = paste0("https://www.lego.com", links.harrypotter)

sets.harrypotter = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.harrypotter)){
  
  html = read_html(links.harrypotter[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.harrypotter = add_row(sets.harrypotter, price, setname, category, pieces, age, articlenum)
}

sets.harrypotter


# IDEAS -------------------------------------------------------------------

nextlinks.ideas = "https://www.lego.com/de-de/themes/ideas"

links.ideas = c()
for (i in 1:length(nextlinks.ideas)){
  remDr$navigate(nextlinks.ideas[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.ideas[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.ideas <- c(links.ideas, links)
}

links.ideas = paste0("https://www.lego.com", links.ideas)

sets.ideas = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.ideas)){
  
  html = read_html(links.ideas[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.ideas = add_row(sets.ideas, price, setname, category, pieces, age, articlenum)
}

sets.ideas


# Jurassic World ----------------------------------------------------------

nextlinks.jurassic = "https://www.lego.com/de-de/themes/jurassic-world"

links.jurassic = c()
for (i in 1:length(nextlinks.jurassic)){
  remDr$navigate(nextlinks.jurassic[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.jurassic[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.jurassic <- c(links.jurassic, links)
}

links.jurassic = paste0("https://www.lego.com", links.jurassic)

sets.jurassic = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.jurassic)){
  
  html = read_html(links.jurassic[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.jurassic = add_row(sets.jurassic, price, setname, category, pieces, age, articlenum)
}

sets.jurassic


# LEGO Art ----------------------------------------------------------------

nextlinks.art = "https://www.lego.com/de-de/themes/art"

links.art = c()
for (i in 1:length(nextlinks.art)){
  remDr$navigate(nextlinks.art[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.art[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.art <- c(links.art, links)
}

links.art = paste0("https://www.lego.com", links.art)

sets.art = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.art)){
  
  html = read_html(links.art[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.art = add_row(sets.art, price, setname, category, pieces, age, articlenum)
}

sets.art


# LEGO Education ----------------------------------------------------------

nextlinks.educ = "https://www.lego.com/de-de/themes/lego-education"

links.educ = c()
for (i in 1:length(nextlinks.educ)){
  remDr$navigate(nextlinks.educ[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.educ[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.educ <- c(links.educ, links)
}

links.educ = paste0("https://www.lego.com", links.educ)

sets.educ = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.educ)){
  
  html = read_html(links.educ[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.educ = add_row(sets.educ, price, setname, category, pieces, age, articlenum)
}

sets.educ


# LEGO Super Mario --------------------------------------------------------

nextlinks.supermario = c("https://www.lego.com/de-de/themes/super-mario", "https://www.lego.com/de-de/themes/super-mario?page=2")

links.supermario = c()
for (i in 1:length(nextlinks.supermario)){
  remDr$navigate(nextlinks.supermario[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.supermario[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.supermario <- c(links.supermario, links)
}

links.supermario = paste0("https://www.lego.com", links.supermario)

sets.supermario = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.supermario)){
  
  html = read_html(links.supermario[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.supermario = add_row(sets.supermario, price, setname, category, pieces, age, articlenum)
}

sets.supermario


# Marvel ------------------------------------------------------------------

nextlinks.marvel = c("https://www.lego.com/de-de/themes/marvel", paste0("https://www.lego.com/de-de/themes/marvel?page=", 2:3))

links.marvel = c()
for (i in 1:length(nextlinks.marvel)){
  remDr$navigate(nextlinks.marvel[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.marvel[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.marvel <- c(links.marvel, links)
}

links.marvel = paste0("https://www.lego.com", links.marvel)

sets.marvel = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.marvel)){
  
  html = read_html(links.marvel[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.marvel = add_row(sets.marvel, price, setname, category, pieces, age, articlenum)
}

sets.marvel


# Mindstorms --------------------------------------------------------------

nextlinks.mindstorms = "https://www.lego.com/de-de/themes/mindstorms"

links.mindstorms = c()
for (i in 1:length(nextlinks.mindstorms)){
  remDr$navigate(nextlinks.mindstorms[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.mindstorms[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.mindstorms <- c(links.mindstorms, links)
}

links.mindstorms = paste0("https://www.lego.com", links.mindstorms)

sets.mindstorms = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.mindstorms)){
  
  html = read_html(links.mindstorms[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.mindstorms = add_row(sets.mindstorms, price, setname, category, pieces, age, articlenum)
}

sets.mindstorms


# Minecraft ---------------------------------------------------------------

nextlinks.minecraft = c("https://www.lego.com/de-de/themes/minecraft", "https://www.lego.com/de-de/themes/minecraft?page=2")

links.minecraft = c()
for (i in 1:length(nextlinks.minecraft)){
  remDr$navigate(nextlinks.minecraft[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.minecraft[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.minecraft <- c(links.minecraft, links)
}

links.minecraft = paste0("https://www.lego.com", links.minecraft)

sets.minecraft = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.minecraft)){
  
  html = read_html(links.minecraft[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.minecraft = add_row(sets.minecraft, price, setname, category, pieces, age, articlenum)
}

sets.minecraft


# Minifigures -------------------------------------------------------------

nextlinks.minifigs = "https://www.lego.com/de-de/themes/minifigures"

links.minifigs = c()
for (i in 1:length(nextlinks.minifigs)){
  remDr$navigate(nextlinks.minifigs[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.minifigs[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.minifigs <- c(links.minifigs, links)
}

links.minifigs = paste0("https://www.lego.com", links.minifigs)

sets.minifigs = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.minifigs)){
  
  html = read_html(links.minifigs[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.minifigs = add_row(sets.minifigs, price, setname, category, pieces, age, articlenum)
}

sets.minifigs


# Minions -----------------------------------------------------------------

nextlinks.minions = "https://www.lego.com/de-de/themes/minions"

links.minions = c()
for (i in 1:length(nextlinks.minions)){
  remDr$navigate(nextlinks.minions[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.minions[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.minions <- c(links.minions, links)
}

links.minions = paste0("https://www.lego.com", links.minions)

sets.minions = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.minions)){
  
  html = read_html(links.minions[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.minions = add_row(sets.minions, price, setname, category, pieces, age, articlenum)
}

sets.minions


# Monkie kid --------------------------------------------------------------

nextlinks.monkie = c("https://www.lego.com/de-de/themes/monkie-kid", "https://www.lego.com/de-de/themes/monkie-kid?page=2")

links.monkie = c()
for (i in 1:length(nextlinks.monkie)){
  remDr$navigate(nextlinks.monkie[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.monkie[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.monkie <- c(links.monkie, links)
}

links.monkie = paste0("https://www.lego.com", links.monkie)

sets.monkie = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.monkie)){
  
  html = read_html(links.monkie[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.monkie = add_row(sets.monkie, price, setname, category, pieces, age, articlenum)
}

sets.monkie


# POWERED UP --------------------------------------------------------------

nextlinks.powered = "https://www.lego.com/de-de/themes/powered-up"

links.powered = c()
for (i in 1:length(nextlinks.powered)){
  remDr$navigate(nextlinks.powered[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.powered[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.powered <- c(links.powered, links)
}

links.powered = paste0("https://www.lego.com", links.powered)

sets.powered = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.powered)){
  
  html = read_html(links.powered[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.powered = add_row(sets.powered, price, setname, category, pieces, age, articlenum)
}

sets.powered


# Serious play ------------------------------------------------------------

nextlinks.seriousplay = "https://www.lego.com/de-de/themes/serious-play"

links.seriousplay = c()
for (i in 1:length(nextlinks.seriousplay)){
  remDr$navigate(nextlinks.seriousplay[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.seriousplay[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.seriousplay <- c(links.seriousplay, links)
}

links.seriousplay = paste0("https://www.lego.com", links.seriousplay)

sets.seriousplay = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.seriousplay)){
  
  html = read_html(links.seriousplay[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.seriousplay = add_row(sets.seriousplay, price, setname, category, pieces, age, articlenum)
}

sets.seriousplay


# Speed Champions ---------------------------------------------------------

nextlinks.speedchampions = "https://www.lego.com/de-de/themes/speed-champions"

links.speedchampions = c()
for (i in 1:length(nextlinks.speedchampions)){
  remDr$navigate(nextlinks.speedchampions[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.speedchampions[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.speedchampions <- c(links.speedchampions, links)
}

links.speedchampions = paste0("https://www.lego.com", links.speedchampions)

sets.speedchampions = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.speedchampions)){
  
  html = read_html(links.speedchampions[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.speedchampions = add_row(sets.speedchampions, price, setname, category, pieces, age, articlenum)
  
}

sets.speedchampions


# Spider-man --------------------------------------------------------------

nextlinks.spiderman = c("https://www.lego.com/de-de/themes/lego-spider-man", "https://www.lego.com/de-de/themes/lego-spider-man?page=2")

links.spiderman = c()
for (i in 1:length(nextlinks.spiderman)){
  remDr$navigate(nextlinks.spiderman[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.spiderman[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.spiderman <- c(links.spiderman, links)
}

links.spiderman = paste0("https://www.lego.com", links.spiderman)

sets.spiderman = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.spiderman)){
  
  html = read_html(links.spiderman[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.spiderman = add_row(sets.spiderman, price, setname, category, pieces, age, articlenum)
}

sets.spiderman


# Star Wars ---------------------------------------------------------------

nextlinks.starwars = c("https://www.lego.com/de-de/themes/star-wars", paste0("https://www.lego.com/de-de/themes/star-wars?page=", 2:4))

links.starwars = c()
for (i in 1:length(nextlinks.starwars)){
  remDr$navigate(nextlinks.starwars[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.starwars[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.starwars <- c(links.starwars, links)
}

links.starwars = paste0("https://www.lego.com", links.starwars)

sets.starwars = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.starwars)){
  
  html = read_html(links.starwars[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.starwars = add_row(sets.starwars, price, setname, category, pieces, age, articlenum)
}

sets.starwars


# Stranger Things ---------------------------------------------------------

nextlinks.strangerthings = "https://www.lego.com/de-de/themes/stranger-things"

links.strangerthings = c()
for (i in 1:length(nextlinks.strangerthings)){
  remDr$navigate(nextlinks.strangerthings[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.strangerthings[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.strangerthings <- c(links.strangerthings, links)
}

links.strangerthings = paste0("https://www.lego.com", links.strangerthings)

sets.strangerthings = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.strangerthings)){
  
  html = read_html(links.strangerthings[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.strangerthings = add_row(sets.strangerthings, price, setname, category, pieces, age, articlenum)
}

sets.strangerthings


# Technic -----------------------------------------------------------------

nextlinks.technic = c("https://www.lego.com/de-de/themes/technic", paste0("https://www.lego.com/de-de/themes/technic?page=", 2:3))

links.technic = c()
for (i in 1:length(nextlinks.technic)){
  remDr$navigate(nextlinks.technic[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.technic[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.technic <- c(links.technic, links)
}

links.technic = paste0("https://www.lego.com", links.technic)

sets.technic = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.technic)){
  
  html = read_html(links.technic[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.technic = add_row(sets.technic, price, setname, category, pieces, age, articlenum)
}

sets.technic


# Vidiyo ------------------------------------------------------------------

nextlinks.vidiyo = "https://www.lego.com/de-de/themes/vidiyo"

links.vidiyo = c()
for (i in 1:length(nextlinks.vidiyo)){
  remDr$navigate(nextlinks.vidiyo[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.vidiyo[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.vidiyo <- c(links.vidiyo, links)
}

links.vidiyo = paste0("https://www.lego.com", links.vidiyo)

sets.vidiyo = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.vidiyo)){
  
  html = read_html(links.vidiyo[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.vidiyo = add_row(sets.vidiyo, price, setname, category, pieces, age, articlenum)
}

sets.vidiyo

# Xtra --------------------------------------------------------------------

nextlinks.xtra = "https://www.lego.com/de-de/themes/xtra"

links.xtra = c()
for (i in 1:length(nextlinks.xtra)){
  remDr$navigate(nextlinks.xtra[i])
  
  webElem <- remDr$findElement("css", "body")
  webElem$sendKeysToElement(list(key = "end"))
  
  links <- nextlinks.xtra[i] %>% read_html() %>%
    html_nodes("a") %>%
    html_attr("href") %>% 
    str_subset("/product/") %>% 
    unique()
  
  links.xtra <- c(links.xtra, links)
}

links.xtra = paste0("https://www.lego.com", links.xtra)

sets.xtra = tribble(~price, ~setname, ~category, ~pieces, ~age, ~articlenum)

for (i in 1:length(links.xtra)){
  
  html = read_html(links.xtra[i])
  
  price = html %>% 
    html_elements(".hviDue") %>% 
    html_text(trim=TRUE) %>% 
    str_replace("\\.","") %>% 
    str_replace(",",".") %>% 
    parse_number
  
  setname = html %>% 
    html_elements("h1.Text__BaseText-sc-178efqu-0 > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  category = html %>% 
    html_elements("li.Breadcrumbsstyles__Items-ramwh5-1:nth-child(2) > a:nth-child(1) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE)
  
  pieces = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(2) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  age = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(1) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  articlenum = html %>% 
    html_elements("div.ProductAttributesstyles__AttributeWrapper-sc-1sfk910-1:nth-child(4) > div:nth-child(2) > span:nth-child(1) > span:nth-child(1)") %>% 
    html_text(trim=TRUE) %>% 
    parse_number %>% 
    unique
  
  sets.xtra = add_row(sets.xtra, price, setname, category, pieces, age, articlenum)
}

sets.xtra



# Combining the datasets --------------------------------------------------

lego = rbind(sets.architecture, sets.art, sets.batman, sets.BOOST, sets.brickheadz, sets.bricksketches, sets.city, sets.classic, sets.creator, sets.creatorexp, sets.dc, sets.disney, sets.disneymicky, sets.dots, sets.educ, sets.frozen, sets.harrypotter, sets.ideas, sets.jurassic, sets.marvel, sets.mindstorms, sets.minecraft, sets.minifigs, sets.minions, sets.monkie, sets.powered, sets.seriousplay, sets.speedchampions, sets.spiderman, sets.starwars, sets.strangerthings, sets.supermario, sets.technic, sets.xtra)
```

## Error correction

``` r
which.max(lego$price)
```

    ## [1] 497

``` r
lego[368,1] = 39.99
```

``` r
which.max(lego$price)
```

    ## [1] 497

``` r
lego[477,1] = 39.99
```

``` r
lego = drop_na(lego)
```

## Exploratory data analysis:

``` r
plot(lego$pieces, lego$price, pch=16, bty="n",
     ylab = "Price", xlab = "Pieces", main = "Scatterplot: Price and Pieces")
m0 = lm(lego$price ~ lego$pieces + I(lego$pieces^2))
curve(m0$coefficients[1] + m0$coefficients[2]*x + m0$coefficients[3]*x^2, add = TRUE,
      col = "cornflowerblue", lwd=2)
```

![](/img/posts/Lego/unnamed-chunk-8-1.png)<!-- -->

``` r
plot(lego$age, lego$price, pch=16, bty="n",
     ylab = "Price", xlab = "Age", main = "Scatterplot: Price and Age")
m1 = lm(lego$price ~ lego$age)
curve(m1$coefficients[1] + m1$coefficients[2]*x, add = TRUE,
      col = "forestgreen", lwd=2)
```

![](/img/posts/Lego/unnamed-chunk-9-1.png)<!-- -->

``` r
boxplot(lego$price ~ lego$category)
```

![](/img/posts/Lego/unnamed-chunk-10-1.png)<!-- -->

## Fitting a linear model

``` r
mod = lm(lego$price ~ lego$pieces + I(lego$pieces^2) + lego$age + lego$category)
summary(mod)
```

    ## 
    ## Call:
    ## lm(formula = lego$price ~ lego$pieces + I(lego$pieces^2) + lego$age + 
    ##     lego$category)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -279.990  -12.373   -0.219   10.472  275.312 
    ## 
    ## Coefficients:
    ##                                    Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)                      -1.859e+01  1.606e+01  -1.157 0.247569    
    ## lego$pieces                       1.050e-01  3.957e-03  26.526  < 2e-16 ***
    ## I(lego$pieces^2)                 -4.253e-06  4.642e-07  -9.160  < 2e-16 ***
    ## lego$age                         -7.623e-01  6.327e-01  -1.205 0.228793    
    ## lego$categoryArt                 -2.466e+02  2.913e+01  -8.466 2.23e-16 ***
    ## lego$categoryBatman™             -2.112e+02  2.716e+01  -7.776 3.60e-14 ***
    ## lego$categoryBOOST                1.081e+02  4.178e+01   2.587 0.009945 ** 
    ## lego$categoryBrick Sketches™      2.086e+01  3.115e+01   0.670 0.503380    
    ## lego$categoryBrickHeadz           1.757e+01  1.589e+01   1.106 0.269231    
    ## lego$categoryCity                 3.678e+01  1.559e+01   2.359 0.018685 *  
    ## lego$categoryClassic              2.140e+00  1.739e+01   0.123 0.902072    
    ## lego$categoryCreator 3-in-1-Sets  1.464e+01  1.642e+01   0.892 0.372903    
    ## lego$categoryCreator Expert      -1.616e+01  1.589e+01  -1.017 0.309736    
    ## lego$categoryDC                   3.307e+01  1.650e+01   2.005 0.045444 *  
    ## lego$categoryDie Eiskönigin       3.578e+01  2.456e+01   1.457 0.145618    
    ## lego$categoryDisney™              3.136e+01  1.546e+01   2.029 0.042911 *  
    ## lego$categoryDOTS                 8.383e+00  1.676e+01   0.500 0.617157    
    ## lego$categoryHarry Potter™       -5.522e-02  1.614e+01  -0.003 0.997272    
    ## lego$categoryIdeas               -1.478e+00  1.749e+01  -0.085 0.932679    
    ## lego$categoryJurassic World™      4.923e+01  1.759e+01   2.799 0.005302 ** 
    ## lego$categoryLEGO® Education      2.019e+02  2.020e+01   9.991  < 2e-16 ***
    ## lego$categoryLEGO® Super Mario™   2.927e+01  1.623e+01   1.803 0.071865 .  
    ## lego$categoryMarvel               2.425e+01  1.635e+01   1.482 0.138769    
    ## lego$categoryMINDSTORMS®          2.904e+02  4.161e+01   6.979 8.41e-12 ***
    ## lego$categoryMinecraft®           2.635e+01  1.681e+01   1.567 0.117644    
    ## lego$categoryMinifiguren          2.813e+01  3.134e+01   0.898 0.369728    
    ## lego$categoryMinions              2.646e+01  2.172e+01   1.218 0.223606    
    ## lego$categoryMonkie Kid™          6.578e+00  1.694e+01   0.388 0.697840    
    ## lego$categoryPowered UP           7.553e+01  1.768e+01   4.272 2.27e-05 ***
    ## lego$categorySERIOUS PLAY®        3.038e+02  2.476e+01  12.269  < 2e-16 ***
    ## lego$categorySonstiges            4.786e+01  4.156e+01   1.152 0.249986    
    ## lego$categorySpeed Champions      1.342e+01  1.858e+01   0.722 0.470328    
    ## lego$categorySpider-Man           3.245e+01  1.611e+01   2.014 0.044486 *  
    ## lego$categoryStar Wars™           5.071e+01  1.506e+01   3.368 0.000809 ***
    ## lego$categoryStranger Things      3.078e+01  3.108e+01   0.991 0.322344    
    ## lego$categoryTechnic              3.743e+01  1.581e+01   2.367 0.018288 *  
    ## lego$categoryXtra                 2.656e+01  3.130e+01   0.849 0.396370    
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 39.12 on 561 degrees of freedom
    ## Multiple R-squared:  0.8615, Adjusted R-squared:  0.8526 
    ## F-statistic: 96.94 on 36 and 561 DF,  p-value: < 2.2e-16

``` r
mod2 = lm(lego$price ~ lego$pieces + I(lego$pieces^2) + lego$age)
summary(mod2)
```

    ## 
    ## Call:
    ## lm(formula = lego$price ~ lego$pieces + I(lego$pieces^2) + lego$age)
    ## 
    ## Residuals:
    ##     Min      1Q  Median      3Q     Max 
    ## -227.08  -14.66   -7.49    5.44  442.59 
    ## 
    ## Coefficients:
    ##                    Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)       2.443e+01  5.399e+00   4.525 7.28e-06 ***
    ## lego$pieces       1.016e-01  5.113e-03  19.872  < 2e-16 ***
    ## I(lego$pieces^2) -5.115e-06  6.123e-07  -8.354 4.68e-16 ***
    ## lego$age         -2.002e+00  7.179e-01  -2.788  0.00547 ** 
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 57.38 on 594 degrees of freedom
    ## Multiple R-squared:  0.6845, Adjusted R-squared:  0.6829 
    ## F-statistic: 429.5 on 3 and 594 DF,  p-value: < 2.2e-16

``` r
AIC(mod)
```

    ## [1] 6120.061

``` r
AIC(mod2)
```

    ## [1] 6546.485

``` r
BIC(mod)
```

    ## [1] 6287.018

``` r
BIC(mod2)
```

    ## [1] 6568.453

``` r
### AIC and BIC point to the more complex model. As this is a really big model it might make sense to fit a mixed model
```

## Visualizing results

``` r
cf.mod2 = coef(mod)

x.seq = seq(min(lego$pieces),max(lego$pieces), length.out=100)
y.seq = seq(min(lego$age),max(lego$age), length.out=100)

z = t(outer(x.seq,y.seq, function(x,y) cf.mod2[1] + cf.mod2[2]*x + cf.mod2[3]*x^2 + cf.mod2[4]*y))


legoplot = plot_ly(x=x.seq, y=y.seq, z=z,
                   type = "surface", colors = c("#f55a42", "#f5dd42"), showscale = FALSE, showlegend = FALSE) %>% 
  add_trace(data=lego, x=lego$pieces, y=lego$age, z=lego$price, 
            mode="markers", type="scatter3d",
            marker = list(color="#000000", opacity=0.9, size=4)) %>% 
  layout(scene = list(xaxis=list(title="Piececount"),
                      yaxis=list(title="Suggested Age"),
                      zaxis=list(title="Price")))
legoplot
```
<iframe src="/img/posts/Lego/Legoplot.html" height="500px" width="120%" frameBorder="0"></iframe>